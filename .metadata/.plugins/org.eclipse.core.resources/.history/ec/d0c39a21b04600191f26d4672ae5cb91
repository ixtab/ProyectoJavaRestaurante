package control;

import java.util.List;

import javax.persistence.EntityManager;
import javax.persistence.EntityManagerFactory;
import javax.persistence.Persistence;
import javax.persistence.TypedQuery;
import javax.ws.rs.GET;
import javax.ws.rs.Path;
import javax.ws.rs.Produces;
import javax.ws.rs.QueryParam;

import model.Menu;
import model.Restaurante;

@Path("")

public class WebService {
	@GET
	@Produces({"text/plain"})
	public String enviarJSON(@QueryParam("cp") String cp) {
		
		EntityManagerFactory factoria = Persistence.createEntityManagerFactory("App");
		EntityManager em = factoria.createEntityManager();
		TypedQuery<Restaurante> query = em.createQuery("SELECT r FROM Restaurante r WHERE r.codigopostal = " + cp, Restaurante.class);

		List<Restaurante> restaurante = query.getResultList();
		String msg = "";
		if (restaurante.size()>0) {
			for (Restaurante r : restaurante) {
				msg = r.getNombre() + " - " + r.getDireccion() +
				" - " + r.getCodigopostal() + " - " + r.getPreciomenu();
				
				msg += " Primeros: \n";
				for (Menu m : r.getMenus(r.getIdrestaurante())) {
					
					msg += "\t" + m.getPrimero()+"\n";
				}
				msg+= "Segundos: ";
				for (Menu m : r.getMenus(r.getIdrestaurante())) {
					
					msg += "\t" + m.getSegundo() + "\n";
				}
			}
		} 
		else {
			System.out.println("No hay restaurantes en ese CÃ³digo postal");
		}
		
		return msg;
	}
}
